<!DOCTYPE html>
<HTML lang="en">
	<HEAD>
		<META CHARSET="UTF-8">
		<META name="viewport" content="width=device-width, initial-scale=1.0">
		<LINK href="github.io.css" rel="stylesheet">
		<TITLE>User access count</TITLE>
		<SCRIPT src='text.js'>
		</SCRIPT>
		<SCRIPT type='text/javascript'>
			writeMenu();
		</SCRIPT>
	</HEAD>
	<BODY TOPMARGIN='0' LEFTMARGIN='0' MARGINHEIGHT='0' MARGINWIDTH='0'>
	<TABLE border='1'>
		<THEAD>
		<TR>
		<TH>User Count for https://murugesanopenssl.github.io</TH>
		<TH>Country</TH>
		</TR>
		</THEAD>
		<TBODY id="tbody"></TBODY>
		</TABLE>
		<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyDSNanmji7WVBtQHlPO-J_E5RQu9Qlq4Qw",
    authDomain: "openmurugesan.firebaseapp.com",
    databaseURL: "https://openmurugesan-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "openmurugesan",
    storageBucket: "openmurugesan.firebasestorage.app",
    messagingSenderId: "307675598593",
    appId: "1:307675598593:web:4af163460ce2c3bc719500",
    measurementId: "G-0MFK92PQMP"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const tbody = document.getElementById("tbody");

const id = "VISIT-" + Date.now();
const bow = navigator.userAgent;

const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
const ctry = (tz.includes("Kolkata") || tz.includes("Calcutta")) ? "INDIA" : "Location: UNKNOWN – location for these users is not available due to VPN, proxy, or privacy settings on their device.";

set(ref(db, "userAccess/" + id), {
	browser: bow,
	country: ctry,
	timezone: tz,
	timestamp: Date.now()
});

onValue(ref(db, "userAccess"), snap => {
	tbody.innerHTML = "";
	let counts = {};

	snap.forEach(child => {
		let raw = child.val().country;
		let finalC = (raw === "INDIA") ? "INDIA" : "Location: UNKNOWN – location for these users is not available due to VPN, proxy, or privacy settings on their device.";
		counts[finalC] = (counts[finalC] || 0) + 1;
	});

	Object.keys(counts).forEach(country => {
		tbody.innerHTML += `
		<tr>
			<td valign='top' align='right'>${String(counts[country]).padStart(4,"0")}</td>
			<td valign='top' align='right'>${country}</td>
		</tr>`;
	});
});
</script>
	</BODY>
</HTML>
